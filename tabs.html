
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>unblockzone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      font-weight: bold;
      text-transform: lowercase;
      scrollbar-width: thin;
      scrollbar-color: #333333 #111111;
    }

html, body {
  margin: 0;
  padding: 0;
}

body {
  color: #f8f9fa;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 1;
  background: url('https://images.unsplash.com/photo-1707924962886-12ad20367315?q=80&w=1632&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center fixed;
  background-size: cover;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  z-index: -2;
  filter: brightness(0.7) blur(3px);
}

#particles-js {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
}

.container,
.center-content {
  position: relative;
  z-index: 2;
}

.container {
  display: flex;
  flex-grow: 1;
  height: calc(100vh - 40px);
  width: 100vw;
  overflow: hidden;
}

.sidebar {
  position: fixed;
  width: 4.5vw;
  background: #343a40;
  box-shadow: 0 0 5px rgba(100, 149, 237, 0.3);
  height: 100vh;
  transition: width 0.3s ease-in-out;
  overflow: hidden;
  z-index: 999;
  top: 0;
  left: 0;
  transform: translateZ(0);
  margin-right: -1px;
}

.sidebar {
  width: 6vw; /* previously 4.5vw */
}

.sidebar:hover {
  width: 15vw; /* previously 13vw */
}


.sidebar ul {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding-top: 2rem;
  list-style-type: none;
}

.sidebar a {
  color: #f8f9fa;
  display: flex;
  align-items: center;
  text-decoration: none;
  padding: 0.5rem 0.8rem;
  border-radius: 2vh;
  transition: background 0.2s, transform 0.2s;
}

.sidebar a:hover {
  background: #495057;
  transform: scale(1.05);
}

.nav-container {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.icon {
  width: 2rem;
  height: 2rem;
  display: flex;
  justify-content: center;
  align-items: center;
}

.text {
  white-space: nowrap;
  opacity: 0;
  transform: translateX(-10px);
  transition: all 0.3s ease;
  font-size: 1.3rem;
}

.sidebar:hover .text {
  opacity: 1;
  transform: translateX(0);
}

.highlighted a {
  background: rgba(255, 255, 255, 0.1);
}

.sidebar:hover ~ .main-content {
  margin-left: 6vw; /* match the base (non-hovered) width */
  width: calc(100% - 6vw);
}

.main-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  margin-left: 4.5vw;
  width: calc(100% - 4.5vw);
  transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
}

.browser-header {
  height: 70px;
  background-color: #343a40;
  box-shadow: 0 0 5px rgba(100, 149, 237, 0.3);
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding: 8px 16px;
  position: relative;
  transform: translateZ(0);
  margin-left: -1px;
  gap: 10px;
}

.browser-header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,0.5), rgba(255,255,255,0));
  opacity: 0.3;
}

.url-bar-container {
  display: flex;
  align-items: center;
  flex-grow: 1;
}

.browser-actions {
  display: flex;
  order: -1;
}

.action-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ced4da;
  cursor: pointer;
  transition: background-color 0.2s;
  font-size: 16px;
  margin-right: 4px;
}

.action-btn:hover {
  background-color: #495057;
}

.url-bar-wrapper {
  display: flex;
  align-items: center;
  background-color: #2b3035;
  border-radius: 25px;
  padding: 0 15px;
  height: 40px;
  flex-grow: 1;
}

.url-bar-container {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  margin-left: 10px;
  flex-grow: 1;
}

.url-bar {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: #e9ecef;
  font-size: 16px;
  padding-left: 20px;
}

.content-area {
  flex-grow: 1;
  height: calc(100% - 70px);
  position: relative;
}

iframe {
  width: 100%;
  height: 100%;
  border: none;
  display: none;
}

.home-screen {
  width: 100%;
  height: 100%;
  background: transparent;
  position: absolute;
  top: 0;
  left: 0;
  overflow: hidden;
  z-index: 1;
}

.center-content {
  text-align: center;
  z-index: 10;
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
}

.center-content h1 {
  font-size: 2rem;
  margin-bottom: 10px;
}

.search-bar-small {
  margin-bottom: 20px;
  padding: 8px;
  border-radius: 20px;
  width: 70%;
  font-size: 1rem;
  background-color: #495057;
  border: 1px solid #6c757d;
  color: #f8f9fa;
  box-shadow: 0 0 5px rgba(100, 149, 237, 0.3);
}

.image-circles {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.image-circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
  border: 2px solid rgba(255, 255, 255, 0.8);
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.7);
}

.image-circle:hover {
  transform: scale(1.2);
  box-shadow: 0 0 20px rgba(255, 255, 255, 1);
}

.image-circle img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Particles */
.particles-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}

.particle {
  position: absolute;
  background: #adb5bd;
  border-radius: 50%;
  opacity: 0.1;
  box-shadow: 0 0 8px white;
  animation: floatUp linear infinite;
}

@keyframes floatUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 0.2;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    transform: translateY(-100vh) scale(1.5);
    opacity: 0;
  }
}

/* Sidebar Bottom Buttons */
.sidebar-bottom-buttons {
  display: flex;
  justify-content: space-around;
  align-items: center;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 10px 0;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.sidebar:hover .sidebar-bottom-buttons {
    opacity: 1;
}

.sidebar-bottom-button {
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #f8f9fa;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
}

.sidebar-bottom-button:hover {
  background-color: #495057;
  transform: scale(1.1);
}

/* Popup Styles */
.popup {
  display: none;
  position: fixed; /* Changed to fixed */
  top: 50%; /* Center vertically */
  left: 50%; /* Center horizontally */
  transform: translate(-50%, -50%); /* Adjust position */
  background-color: rgba(52, 58, 64, 0.9); /* Semi-transparent background */
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  width: 250px;
  color: #f8f9fa;
  text-align: center;
  transition: opacity 0.3s ease; /* Fade out transition */
}

/* Popup modifications */
.popup {
    background-color: rgba(52, 58, 64, 1); /* 100% opacity */
    min-width: 300px; /* Base width for all popups */
}

.popup.fade-out {
    opacity: 0;
}

.popup h3 {
  font-size: 1.2rem;
  margin-bottom: 5px;
  color: #fff;
}

.popup hr {
  border-top: 1px solid #fff;
  margin: 10px 0;
  opacity: 0.5;
}

.popup ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.popup li {
  padding: 8px 0;
  border-bottom: 1px solid #fff;
  opacity: 0.7;
}

.popup li:last-child {
  border-bottom: none;
}

.popup.show {
  display: block;
}

.popup .close-button {
    position: absolute;
    top: 5px;
    right: 5px;
    cursor: pointer;
    color: #fff;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.popup .close-button:hover {
    opacity: 1;
}

/* Bookmark Icon in Header */
.bookmark-header-icon {
  font-size: 20px;
  color: #f8f9fa;
  cursor: pointer;
  transition: transform 0.2s, color 0.2s;
}

.bookmark-header-icon:hover {
  transform: scale(1.2);
}

.bookmarked {
    color: #ffc107; /* Darker color when bookmarked */
}

/* Embed Code Popup */
#embed-code-popup textarea {
  width: 100%;
  height: 100px;
  background-color: #343a40;
  color: #f8f9fa;
  border: none;
  padding: 8px;
  border-radius: 5px;
  resize: none;
}

#embed-code-popup {
    width: 450px; /* Wider embed popup */
}

#embed-code-popup .embed-code-container {
    background-color: #2b3035;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 10px;
    text-align: center;
    font-size: 0.9rem;
    word-break: break-all;
}

#embed-code-popup .copy-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
}

#embed-code-popup .copy-button:hover {
    background-color: #0056b3;
}

/* Extension Popup */
#extension-popup p {
  margin-bottom: 10px;
}

#extension-popup ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

#extension-popup li {
    padding: 8px 0;
    border-bottom: 1px solid #fff;
    opacity: 0.7;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#extension-popup li:last-child {
    border-bottom: none;
}

#extension-popup .extension-toggle {
    cursor: pointer;
    color: #fff;
    transition: color 0.2s;
}

#extension-popup .extension-toggle:hover {
    color: #007bff;
}

/* History Popup */
#history-popup ul {
  max-height: 150px;
  overflow-y: auto;
}

#history-popup {
    width: 400px; /* Wider history popup */
}

/* Bookmark Button */
.bookmark-button {
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 5px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 5px;
}

.url-bar-icons {
    display: flex;
    align-items: center;
    gap: 10px; /* Increased gap */
    margin-left: auto; /* Push icons to the right */
    margin-right: 5px; /* Add a little space to the right */
}

.url-bar-icons i {
    cursor: pointer;
    font-size: 18px;
    color: #ced4da;
    transition: color 0.2s, transform 0.2s;
}

.url-bar-icons i:hover {
    color: #fff;
    transform: scale(1.1); /* Zoom on hover */
}

/* Dark mode background */
body.dark-mode {
    background: #000 !important;
}

body.dark-mode .browser-header,
body.dark-mode .sidebar {
    background-color: #000;
}

body.dark-mode .url-bar-wrapper {
    background-color: #222;
}

body.dark-mode .popup {
    background-color: #111;
}

/* Incognito mode background */
body.incognito {
    background: url('https://garden.spoonflower.com/c/15197924/p/f/m/xIIl333PyyzkyIvJPgPxHyC8Zvdl-kAWYNamSdb5DXXqqKQU3gyFusuInw/Charcoal%20Grey%20Dark%20Gray%20Solid%20%234b4646.jpg') center/cover fixed !important;
}

body.incognito .browser-header,
body.incognito .sidebar {
    background-color: #222;
}

body.incognito .url-bar-wrapper {
    background-color: #444;
}

/* Browser actions */
.browser-actions {
    margin-left: 20px; /* Move buttons right */
}

/* Clear history button */
.clear-history-button {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
}

.clear-history-button:hover {
    background-color: #c82333;
}

/* Remove bookmark button */
.remove-bookmark {
    color: #dc3545;
    cursor: pointer;
    margin-left: 10px;
}

.remove-bookmark:hover {
    color: #c82333;
}

/* Bookmark list item */
.bookmark-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
}

// Add this CSS
body.light-mode {
    background: #ffffff !important;
    color: #333333 !important;
}

body.light-mode .browser-header,
body.light-mode .sidebar {
    background-color: #f8f9fa !important;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

body.light-mode .url-bar-wrapper {
    background-color: #ffffff !important;
    border: 1px solid #dee2e6;
}

body.light-mode .url-bar {
    color: #333333 !important;
}

body.light-mode .sidebar a {
    color: #333333 !important;
}

body.light-mode .popup {
    background-color: #ffffff !important;
    color: #333333 !important;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

body.light-mode .action-btn {
    color: #333333 !important;
}

body.light-mode .url-bar-icons i {
    color: #333333 !important;
}

</style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="container">
    <div class="sidebar">
      <ul>
        <li>
          <a href="/index.html" class="home-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-house"></i></div>
              <div class="text">home</div>
            </div>
          </a>
        </li>
        <li>
          <a href="/g.html" class="games-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-gamepad"></i></div>
              <div class="text">games</div>
            </div>
          </a>
        </li>
        <li>
          <a href="/a.html" class="apps-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-mobile"></i></div>
              <div class="text">apps</div>
            </div>
          </a>
        </li>
        <li class="highlighted">
          <a href="/p.html" class="proxy-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-magnifying-glass"></i></div>
              <div class="text">proxy</div>
            </div>
          </a>
        </li>
        <li>
          <a href="/s.html" class="settings-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-cog"></i></div>
              <div class="text">settings</div>
            </div>
          </a>
        </li>
        <li>
          <a href="/partners.html" class="partners-link">
            <div class="nav-container">
              <div class="icon"><i class="fa-solid fa-handshake"></i></div>
              <div class="text">partners</div>
            </div>
          </a>
        </li>
      </ul>

      <div class="sidebar-bottom-buttons">
        <div class="sidebar-bottom-button" onclick="togglePopup('bookmarks-popup')">
          <i class="fa-solid fa-bookmark"></i>
        </div>
        <div class="sidebar-bottom-button" onclick="togglePopup('embed-code-popup')">
          <i class="fa-solid fa-code"></i>
        </div>
        <div class="sidebar-bottom-button" onclick="togglePopup('extension-popup')">
          <i class="fa-solid fa-puzzle-piece"></i>
        </div>
        <div class="sidebar-bottom-button" onclick="togglePopup('history-popup')">
          <i class="fa-solid fa-history"></i>
        </div>
      </div>
    </div>
  
    <div class="main-content">
      <div class="browser-header">
        <div class="browser-actions">
          <div class="action-btn" id="back-btn"><i class="fa-solid fa-arrow-left"></i></div>
          <div class="action-btn" id="forward-btn"><i class="fa-solid fa-arrow-right"></i></div>
          <div class="action-btn" id="reload-btn"><i class="fa-solid fa-rotate-right"></i></div>
        </div>
        <div class="url-bar-container">
          <div class="url-bar-wrapper">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" class="url-bar" id="url-bar" placeholder="enter search or web address" />
            <div class="url-bar-icons">
                <i class="fa-solid fa-bookmark bookmark-header-icon" id="bookmark-icon" onclick="bookmarkCurrentPage()"></i>
                <i class="fa-solid fa-puzzle-piece" onclick="togglePopup('extension-popup')"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="content-area">
        <div class="home-screen" id="home-screen">
        </div>
        <iframe id="main-frame"></iframe>
      </div>
    </div>
  </div>

  <div class="center-content" id="center-content">
    <h1>unblockzone v5</h1>
    <input type="text" class="search-bar-small" id="small-search-bar" placeholder="search or enter a url" />
    <div class="image-circles">
      <div class="image-circle" onclick="navigateToUrl('https://now.gg')"><img src="https://miro.medium.com/v2/resize:fit:1000/1*YM7t6RluDCb0XT62yy2aqQ.png" /></div>
      <div class="image-circle" onclick="navigateToUrl('https://youtube.com')"><img src="https://static.vecteezy.com/system/resources/thumbnails/018/930/572/small/youtube-logo-youtube-icon-transparent-free-png.png" /></div>
      <div class="image-circle" onclick="navigateToUrl('https://tiktok.com')"><img src="https://static.vecteezy.com/system/resources/previews/016/716/450/non_2x/tiktok-icon-free-png.png" /></div>
      <div class="image-circle" onclick="navigateToUrl('https://duckduckgo.com')"><img src="https://upload.wikimedia.org/wikipedia/en/9/90/The_DuckDuckGo_Duck.png" /></div>
      <div class="image-circle" onclick="navigateToUrl('https://poki.com')"><img src="https://cdn-images-1.medium.com/v2/resize:fit:1200/1*7dBqKj2f3J42EjxdEdd1Ng.png" /></div>
    </div>
  </div>

  <div class="particles-container" id="particles-container"></div>

  <!-- Popups -->
  <div class="popup" id="bookmarks-popup">
    <h3>bookmarks</h3>
    <span class="close-button" onclick="closePopup('bookmarks-popup')">&times;</span>
    <hr>
    <ul id="bookmarks-list">
      <!-- Bookmarks will be dynamically added here -->
    </ul>
  </div>

  <div class="popup" id="embed-code-popup">
    <h3>embed link</h3>
    <span class="close-button" onclick="closePopup('embed-code-popup')">&times;</span>
    <hr>
    <div class="embed-code-container">
        <div id="embed-code-text">https://www.unblockzone.online/active/iframe.html#https://</div>
    </div>
    <button class="copy-button" onclick="copyEmbedCode()">copy</button>
  </div>
  

<div class="popup" id="extension-popup">
    <h3>extensions</h3>
    <span class="close-button" onclick="closePopup('extension-popup')">&times;</span>
    <hr>
    <ul>
        <li>
            <span>dark mode</span>
            <span class="extension-toggle" data-extension="dark-mode" onclick="toggleExtension('dark-mode')">
                <i class="fa-solid fa-toggle-off"></i>
            </span>
        </li>
        <li>
            <span>incognito mode</span>
            <span class="extension-toggle" data-extension="incognito" onclick="toggleExtension('incognito')">
                <i class="fa-solid fa-toggle-off"></i>
            </span>
        </li>
        <li>
            <span>ad blocker</span>
            <span class="extension-toggle" data-extension="ad-blocker" onclick="toggleExtension('ad-blocker')">
                <i class="fa-solid fa-toggle-off"></i>
            </span>
        </li>
    </ul>
</div>


<div class="popup" id="history-popup">
    <h3>history</h3>
    <span class="close-button" onclick="closePopup('history-popup')">&times;</span>
    <hr>
    <ul id="history-list">
        <!-- History items will be added here -->
    </ul>
    <button class="clear-history-button" onclick="clearHistory()">clear history</button>
</div>



<script>
  const urlBar = document.getElementById('url-bar');
  const smallSearchBar = document.getElementById('small-search-bar');
  const mainFrame = document.getElementById('main-frame');
  const homeScreen = document.getElementById('home-screen');
  const centerContent = document.getElementById('center-content');
  const sidebarBottomButtons = document.querySelector('.sidebar-bottom-buttons');
  const sidebar = document.querySelector('.sidebar');
  const bookmarkIcon = document.getElementById('bookmark-icon');
  const embedCodeText = document.getElementById('embed-code-text');

  let iframeHistory = [];
  let currentIndex = -1;
  let currentUrl = ''; // Store the current URL
  let activePopup = null; // Track the currently open popup

  // Bookmarks
  let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
  const bookmarksList = document.getElementById('bookmarks-list');

  // History
  let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
  const historyList = document.getElementById('history-list');

  // Extension States
  const extensionStates = {
      'dark-mode': false,
      'incognito': false,
      'download-manager': false,
      'ad-blocker': false,
      'light-mode': false // Added for light mode
  };

  function updateIframe(originalUrl) {
    const cleanedUrl = originalUrl.replace(/^https?:\/\//, '');
    const proxiedUrl = "https://blockzone.github.io/active/iframe.html#https://" + cleanedUrl;

    mainFrame.src = proxiedUrl;
    mainFrame.style.display = "block";
    homeScreen.style.display = "none";
    centerContent.style.display = "none";

    // Show the original URL (not the proxy one)
    urlBar.value = originalUrl;
    currentUrl = originalUrl; // Update currentUrl

    // Update Embed Code
    embedCodeText.textContent = "https://www.unblockzone.online/active/iframe.html#https://" + cleanedUrl;

    // Check if the current URL is bookmarked
    if (bookmarks.some(bookmark => bookmark.url === currentUrl)) {
        bookmarkIcon.classList.add('bookmarked');
    } else {
        bookmarkIcon.classList.remove('bookmarked');
    }
  }

  function navigateToUrl(input) {
    if (!input.trim()) return;

    let formattedUrl = input.trim();

    // Basic cleanup and normalization
    if (!formattedUrl.startsWith("http://") && !formattedUrl.startsWith("https://")) {
      if (formattedUrl.includes(".")) {
        formattedUrl = "https://" + formattedUrl;
      } else {
        formattedUrl = "https://duckduckgo.com/?q=" + encodeURIComponent(formattedUrl);
      }
    }

    iframeHistory = iframeHistory.slice(0, currentIndex + 1);
    iframeHistory.push(formattedUrl);
    currentIndex++;
    updateIframe(formattedUrl);

    // Update History
    addSearchToHistory(formattedUrl);
  }

  urlBar.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      navigateToUrl(urlBar.value);
    }
  });

  smallSearchBar.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      navigateToUrl(smallSearchBar.value);
    }
  });

  document.getElementById("back-btn").onclick = () => {
    if (currentIndex > 0) {
      currentIndex--;
      updateIframe(iframeHistory[currentIndex]);
    }
  };

  document.getElementById("forward-btn").onclick = () => {
    if (currentIndex < iframeHistory.length - 1) {
      currentIndex++;
      updateIframe(iframeHistory[currentIndex]);
    }
  };

  document.getElementById("reload-btn").onclick = () => {
    if (currentIndex >= 0) {
      updateIframe(iframeHistory[currentIndex]);
    }
  };

  // Popup Functions
  function togglePopup(popupId) {
      const popup = document.getElementById(popupId);

      if (activePopup === popupId) {
          // If the popup is already open, close it
          closePopup(popupId);
      } else {
          // Close any currently open popup
          if (activePopup) {
              closePopup(activePopup);
          }

          // Open the new popup
          popup.classList.add('show');
          activePopup = popupId;
      }
  }

  function closePopup(popupId) {
      const popup = document.getElementById(popupId);
      popup.classList.add('fade-out'); // Start fade out

      setTimeout(() => {
          popup.classList.remove('show', 'fade-out'); // Hide after transition
          activePopup = null; // Reset active popup
      }, 300); // Match transition duration
  }

  // Bookmarks Functions
  function bookmarkCurrentPage() {
    if (!currentUrl) return;

    const pageTitle = currentUrl; // Replace with actual page title if available
    const bookmark = { url: currentUrl, title: pageTitle };

    const isBookmarked = bookmarks.some(b => b.url === currentUrl);

    if (isBookmarked) {
        // Remove bookmark
        bookmarks = bookmarks.filter(b => b.url !== currentUrl);
        bookmarkIcon.classList.remove('bookmarked');
    } else {
        // Add bookmark
        bookmarks.push(bookmark);
        
        bookmarkIcon.classList.add('bookmarked');
    }

    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    updateBookmarksList();
  }

  function updateBookmarksList() {
    bookmarksList.innerHTML = '';
    bookmarks.forEach(bookmark => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="${bookmark.url}">${bookmark.title}</a>`;
      li.onclick = (event) => {
          event.preventDefault(); // Prevent default link behavior
          navigateToUrl(bookmark.url);
          closePopup('bookmarks-popup');
      };
      bookmarksList.appendChild(li);
    });
  }

  // History Functions
  function addSearchToHistory(url) {
    searchHistory.unshift(url); // Add to the beginning
    searchHistory = searchHistory.slice(0, 10); // Limit to 10 entries
    localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
    updateHistoryList();
  }

  function updateHistoryList() {
    historyList.innerHTML = '';
    searchHistory.forEach(url => {
      const li = document.createElement('li');
      li.textContent = url;
      li.onclick = () => navigateToUrl(url);
      historyList.appendChild(li);
    });
  }

  function copyEmbedCode() {
    const code = embedCodeText.textContent;
    navigator.clipboard.writeText(code)
      .then(() => {
        alert('Embed code copied to clipboard!');
      })
      .catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy embed code.');
      });
  }

  // Modified toggleExtension function with light mode
  function toggleExtension(extensionName) {
      extensionStates[extensionName] = !extensionStates[extensionName];
      const toggleElement = document.querySelector(`.extension-toggle[data-extension="${extensionName}"] i`);

      if (extensionStates[extensionName]) {
          toggleElement.classList.remove('fa-toggle-off');
          toggleElement.classList.add('fa-toggle-on');
          
          // Handle specific extensions
          if (extensionName === 'dark-mode') {
              document.body.classList.add('dark-mode');
          } else if (extensionName === 'incognito') {
              document.body.classList.add('incognito');
          } else if (extensionName === 'light-mode') {
              document.body.classList.add('light-mode');
              localStorage.setItem('lightMode', 'enabled');
          }
      } else {
          toggleElement.classList.remove('fa-toggle-on');
          toggleElement.classList.add('fa-toggle-off');
          
          // Handle specific extensions
          if (extensionName === 'dark-mode') {
              document.body.classList.remove('dark-mode');
          } else if (extensionName === 'incognito') {
              document.body.classList.remove('incognito');
          } else if (extensionName === 'light-mode') {
              document.body.classList.remove('light-mode');
              localStorage.setItem('lightMode', 'disabled');
          }
      }
  }

  // Initialize light mode if it's saved in localStorage
  if (localStorage.getItem('lightMode') === 'enabled') {
    document.body.classList.add('light-mode');
    extensionStates['light-mode'] = true;
    const toggleElement = document.querySelector('.extension-toggle[data-extension="light-mode"] i');
    toggleElement.classList.remove('fa-toggle-off');
    toggleElement.classList.add('fa-toggle-on');
  }

  // Clear history function
  function clearHistory() {
    searchHistory = [];
    localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
    updateHistoryList();
  }

  // Load saved extension states
  function loadSavedExtensionStates() {
    const savedStates = JSON.parse(localStorage.getItem('extensionStates')) || {};
    Object.keys(savedStates).forEach(extension => {
        if (savedStates[extension]) {
            extensionStates[extension] = true;
            const toggleElement = document.querySelector(`.extension-toggle[data-extension="${extension}"] i`);
            if (toggleElement) {
                toggleElement.classList.remove('fa-toggle-off');
                toggleElement.classList.add('fa-toggle-on');
            }
            applyExtensionState(extension, true);
        }
    });
  }

  // Apply extension state
  function applyExtensionState(extensionName, state) {
    switch(extensionName) {
        case 'dark-mode':
            if (state) document.body.classList.add('dark-mode');
            else document.body.classList.remove('dark-mode');
            break;
        case 'incognito':
            if (state) document.body.classList.add('incognito');
            else document.body.classList.remove('incognito');
            break;
        case 'custom-cursor':
            if (state) document.body.classList.add('custom-cursor');
            else document.body.classList.remove('custom-cursor');
            cursorDot.style.display = state ? 'block' : 'none';
            break;
        case 'ad-blocker':
            if (state) enableAdBlocker();
            else disableAdBlocker();
            break;
        case 'light-mode': // Adding the light mode case here
            if (state) document.body.classList.add('light-mode');
            else document.body.classList.remove('light-mode');
            break;
    }
  }

  // Modified toggleExtension function with saving states to localStorage
  function toggleExtension(extensionName) {
    extensionStates[extensionName] = !extensionStates[extensionName];
    const toggleElement = document.querySelector(`.extension-toggle[data-extension="${extensionName}"] i`);

    if (extensionStates[extensionName]) {
        toggleElement.classList.remove('fa-toggle-off');
        toggleElement.classList.add('fa-toggle-on');
    } else {
        toggleElement.classList.remove('fa-toggle-on');
        toggleElement.classList.add('fa-toggle-off');
    }

    applyExtensionState(extensionName, extensionStates[extensionName]);
    
    // Save states to localStorage
    localStorage.setItem('extensionStates', JSON.stringify(extensionStates));
  }

  // Ad Blocker functionality
  function enableAdBlocker() {
    const adPatterns = [
        'ads', 'advertisement', 'banner', 'sponsor', 'advertising',
        'google_ads', 'adsense', 'advert', 'promotions', 'sponsored'
    ];
    
    setInterval(() => {
        if (extensionStates['ad-blocker']) {
            const elements = document.querySelectorAll('iframe, div, img, a');
            elements.forEach(element => {
                const elementString = (element.id + ' ' + element.className + ' ' + element.src + ' ' + element.href).toLowerCase();
                if (adPatterns.some(pattern => elementString.includes(pattern))) {
                    element.style.display = 'none';
                }
            });
        }
    }, 1000);
  }

  // Modified popup management
  function togglePopup(popupId) {
    // Close any open popup
    const openPopup = document.querySelector('.popup.show');
    if (openPopup) {
        closePopup(openPopup.id);
    }
    
    // Open new popup if it's not the one that was just closed
    if (!openPopup || openPopup.id !== popupId) {
        const popup = document.getElementById(popupId);
        popup.classList.add('show');
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    loadSavedExtensionStates();
  });

  // Initial Load
  updateBookmarksList();
  updateHistoryList();
</script>
</body>
</html>


